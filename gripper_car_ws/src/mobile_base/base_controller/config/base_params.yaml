# ==============================================================================
# BASE CONTROLLER PARAMETERS
# ==============================================================================
# Configuration for 4-wheel differential drive mobile base with Arduino control.
#
# This file configures three ROS2 nodes:
#   1. serial_bridge - Arduino communication
#   2. odom_publisher - Odometry calculation from encoder ticks
#   3. teleop_keyboard - Manual keyboard control
#
# Robot Physical Parameters:
#   - Wheel Radius: 0.075m (75mm)
#   - Wheel Base: 0.35m (distance between left and right wheel centers)
#   - Encoder Resolution: 360 CPR (counts per revolution)
#
# ==============================================================================

# ------------------------------------------------------------------------------
# SERIAL BRIDGE NODE
# ------------------------------------------------------------------------------
# Handles serial communication with Arduino Mega 2560.
# Converts ROS2 cmd_vel to Arduino protocol and publishes encoder ticks.
#
# Topics Published:
#   /encoder_ticks (std_msgs/Int64MultiArray) - Raw encoder counts [FL, FR, BL, BR]
#   /base/status (std_msgs/String) - Status messages from Arduino
#
# Topics Subscribed:
#   /cmd_vel (geometry_msgs/Twist) - Velocity commands
#
# Services:
#   /base/set_test_mode (std_srvs/SetBool) - Enable/disable TEST mode
#
serial_bridge:
  ros__parameters:
    # Serial port - typically /dev/ttyACM0 for Arduino Mega or /dev/ttyUSB0 for CH340
    serial_port: "/dev/ttyUSB0"

    # Baud rate - must match Arduino code (115200)
    baud_rate: 115200

    # Command timeout - send STOP if no cmd_vel received within this time
    cmd_timeout: 0.5  # seconds

    # Time between reconnection attempts if serial connection is lost
    reconnect_interval: 2.0  # seconds

# ------------------------------------------------------------------------------
# ODOMETRY PUBLISHER NODE
# ------------------------------------------------------------------------------
# Calculates robot pose and velocity from encoder ticks using differential drive
# kinematics. Publishes odometry messages and broadcasts TF.
#
# Topics Published:
#   /odom (nav_msgs/Odometry) - Robot pose and velocity
#   /joint_states (sensor_msgs/JointState) - Wheel joint positions
#
# Topics Subscribed:
#   /encoder_ticks (std_msgs/Int64MultiArray) - From serial_bridge
#
# TF Broadcast:
#   odom -> body_link
#
odom_publisher:
  ros__parameters:
    # ========== ROBOT KINEMATICS ==========
    # These MUST match the physical robot and Arduino configuration!

    # Encoder counts per wheel revolution (after quadrature decoding)
    encoder_ticks_per_rev: 360

    # Wheel radius in meters
    wheel_radius: 0.075  # 75mm

    # Distance between left and right wheel centers in meters
    # For 4-wheel robot: this is the track width (left-right distance)
    wheel_base: 0.35  # 350mm = 2 * 175mm (wheel offset from center)

    # ========== TF FRAMES ==========
    # Frame names must match URDF
    base_frame: "body_link"  # Robot base frame (center of robot)
    odom_frame: "odom"       # Odometry frame (world-fixed)

    # ========== PUBLISHING ==========
    # Whether to broadcast TF (odom -> base_frame)
    # Set to false if using robot_localization package for sensor fusion
    publish_tf: true

    # Publishing rate (Hz) - matches encoder publishing rate from Arduino
    publish_rate: 50.0

    # ========== WHEEL JOINTS ==========
    # Joint names for publishing to /joint_states (must match URDF)
    wheel_joints:
      - "front_left_joint"
      - "front_right_joint"
      - "back_left_joint"
      - "back_right_joint"

    # ========== COVARIANCE ==========
    # Covariance values for sensor fusion with EKF (robot_localization)
    # Format: [x, y, z, roll, pitch, yaw]
    # Higher values = less trust in wheel odometry
    pose_covariance_diagonal: [0.01, 0.01, 0.01, 0.01, 0.01, 0.03]
    twist_covariance_diagonal: [0.01, 0.01, 0.01, 0.01, 0.01, 0.03]

# ------------------------------------------------------------------------------
# TELEOP KEYBOARD NODE
# ------------------------------------------------------------------------------
# Keyboard control for manual robot operation.
#
# Controls:
#   w/s: Forward/Backward
#   a/d: Turn left/right
#   q/e: Forward diagonal
#   z/c: Backward diagonal
#   x/SPACE: Stop
#   +/-: Increase/decrease linear speed
#   [/]: Increase/decrease angular speed
#
teleop_keyboard:
  ros__parameters:
    # Initial speed settings
    linear_speed: 0.3   # m/s - forward/backward speed
    angular_speed: 0.5  # rad/s - turning speed

    # Speed adjustment increments (when pressing +/- or [/])
    linear_step: 0.05   # m/s per keypress
    angular_step: 0.1   # rad/s per keypress

    # Maximum allowed speeds (safety limits)
    max_linear_speed: 1.0   # m/s
    max_angular_speed: 2.0  # rad/s
