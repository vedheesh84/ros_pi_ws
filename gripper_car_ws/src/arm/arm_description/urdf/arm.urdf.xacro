<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro"
       name="mobile_arm_bot_2">

  <!-- ========================================================= -->
  <!--                      MACROS                               -->
  <!-- ========================================================= -->

  <!-- Generic link: inertial + visual + collision (mesh) -->
  <xacro:macro name="link_with_mesh" params="name mesh xyz rpy mass ixx ixy ixz iyy iyz izz">
    <link name="${name}">
      <inertial>
        <origin xyz="${xyz}" rpy="${rpy}" />
        <mass value="${mass}" />
        <inertia ixx="${ixx}" ixy="${ixy}" ixz="${ixz}"
                 iyy="${iyy}" iyz="${iyz}" izz="${izz}" />
      </inertial>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry><mesh filename="${mesh}"/></geometry>
      </visual>

      <collision>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry><mesh filename="${mesh}"/></geometry>
      </collision>
    </link>
  </xacro:macro>

  <!-- Simple revolute joint -->
  <xacro:macro name="rev_joint" params="name parent child xyz rpy axis lower upper effort velocity">
    <joint name="${name}" type="revolute">
      <origin xyz="${xyz}" rpy="${rpy}"/>
      <parent link="${parent}"/>
      <child link="${child}"/>
      <axis xyz="${axis}"/>
      <limit lower="${lower}" upper="${upper}" effort="${effort}" velocity="${velocity}"/>
    </joint>
  </xacro:macro>

  <!-- Revolute joint with mimic -->
  <xacro:macro name="rev_joint_mimic"
               params="name parent child xyz rpy axis lower upper effort velocity mimic_joint multiplier offset">
    <joint name="${name}" type="revolute">
      <origin xyz="${xyz}" rpy="${rpy}" />
      <parent link="${parent}" />
      <child link="${child}" />
      <axis xyz="${axis}" />
      <limit lower="${lower}" upper="${upper}" effort="${effort}" velocity="${velocity}" />
      <mimic joint="${mimic_joint}" multiplier="${multiplier}" offset="${offset}" />
    </joint>
  </xacro:macro>


  <!-- ========================================================= -->
  <!--                        LINKS                              -->
  <!-- (All link inertial + meshes copied from original URDF)   -->
  <!-- ========================================================= -->

  <xacro:link_with_mesh
    name="base_link"
    mesh="package://arm_description/meshes/base_link.STL"
    xyz="-0.00036726 0.0001156 0.022489"
    rpy="0 0 0"
    mass="0.093638"
    ixx="0.00012547" ixy="-2.5159E-08" ixz="1.5661E-06"
    iyy="0.00013089" iyz="-1.4418E-07" izz="0.00020147"/>

  <xacro:link_with_mesh
    name="link_1"
    mesh="package://arm_description/meshes/link_1.STL"
    xyz="0.002243 0.0075762 0.018765"
    rpy="0 0 0"
    mass="0.072312"
    ixx="4.9568E-05" ixy="-1.5508E-06" ixz="-6.3994E-06"
    iyy="6.2445E-05" iyz="-6.7489E-06" izz="5.6938E-05"/>

  <xacro:link_with_mesh
    name="link_2"
    mesh="package://arm_description/meshes/link_2.STL"
    xyz="-0.00012948 -0.0043336 0.059294"
    rpy="0 0 0"
    mass="0.056532"
    ixx="9.4195E-05" ixy="-3.005E-10" ixz="-1.4691E-09"
    iyy="9.7021E-05" iyz="-3.0019E-10" izz="7.2804E-06"/>

  <xacro:link_with_mesh
    name="link_3"
    mesh="package://arm_description/meshes/link_3.STL"
    xyz="0.03808 0.013781 -0.00091995"
    rpy="0 0 0"
    mass="0.05696"
    ixx="1.1086E-05" ixy="-9.9972E-07" ixz="1.4846E-06"
    iyy="6.7149E-05" iyz="5.5761E-08" izz="6.3613E-05"/>

  <xacro:link_with_mesh
    name="link_4"
    mesh="package://arm_description/meshes/link_4.STL"
    xyz="0.029998 -0.0057413 0.0048155"
    rpy="0 0 0"
    mass="0.018176"
    ixx="2.8956E-06" ixy="6.016E-07" ixz="1.9471E-08"
    iyy="5.3577E-06" iyz="-1.8766E-08" izz="4.262E-06"/>

  <xacro:link_with_mesh
    name="gripper_base_link"
    mesh="package://arm_description/meshes/gripper_base_link.STL"
    xyz="0.023551 -0.014074 0.0056942"
    rpy="0 0 0"
    mass="0.015721"
    ixx="2.5605E-06" ixy="-1.4166E-06" ixz="-1.3765E-06"
    iyy="7.2536E-06" iyz="-3.5787E-07" izz="8.1096E-06"/>

  <xacro:link_with_mesh
    name="left_gear_link"
    mesh="package://arm_description/meshes/left_gear_link.STL"
    xyz="0.0056831 -0.00040658 0.016"
    rpy="0 0 0"
    mass="0.0025659"
    ixx="9.0729E-08" ixy="-1.9117E-08" ixz="2.1722E-19"
    iyy="3.6228E-07" iyz="-4.5607E-20" izz="4.4616E-07"/>

  <xacro:link_with_mesh
    name="left_finger_link"
    mesh="package://arm_description/meshes/left_finger_link.STL"
    xyz="0.026893 0.0045131 -0.0042469"
    rpy="0 0 0"
    mass="0.0053975"
    ixx="1.8308E-07" ixy="-3.7341E-07" ixz="-6.5545E-12"
    iyy="1.5958E-06" iyz="1.2621E-11" izz="1.7139E-06"/>

  <xacro:link_with_mesh
    name="right_gear_link"
    mesh="package://arm_description/meshes/right_gear_link.STL"
    xyz="0.0055788 0.00060197 0.016"
    rpy="0 0 0"
    mass="0.0026416"
    ixx="9.0046E-08" ixy="9.2574E-09" ixz="4.4469E-21"
    iyy="3.6424E-07" iyz="-3.7286E-20" izz="4.4724E-07"/>

  <xacro:link_with_mesh
    name="right_finger_link"
    mesh="package://arm_description/meshes/right_finger_link.STL"
    xyz="0.026893 0.0045131 -0.0042469"
    rpy="0 0 0"
    mass="0.0053975"
    ixx="1.8308E-07" ixy="-3.7341E-07" ixz="-6.6286E-12"
    iyy="1.5958E-06" iyz="1.2817E-11" izz="1.7139E-06"/>

  <xacro:link_with_mesh
    name="left_link"
    mesh="package://arm_description/meshes/left_link.STL"
    xyz="0.0155 -7.3067E-15 0.017505"
    rpy="0 0 0"
    mass="0.00079876"
    ixx="3.6325E-09" ixy="1.2874E-22" ixz="-8.1684E-23"
    iyy="1.0292E-07" iyz="-6.2142E-22" izz="1.0442E-07"/>

  <xacro:link_with_mesh
    name="right_link"
    mesh="package://arm_description/meshes/right_link.STL"
    xyz="0.0155 -7.3899E-15 0.01783"
    rpy="0 0 0"
    mass="0.00079876"
    ixx="3.6325E-09" ixy="-6.1069E-23" ixz="-7.2482E-23"
    iyy="1.0292E-07" iyz="-6.2762E-22" izz="1.0442E-07"/>


  <!-- ========================================================= -->
  <!--                        JOINTS                             -->
  <!-- (All joints translated to macros; mimic joints use rev_joint_mimic) -->
  <!-- ========================================================= -->

  <!-- Joint limits match servo_bridge.py for real hardware compatibility -->
  <xacro:rev_joint name="joint_1"
                   parent="base_link" child="link_1"
                   xyz="0 0 0.056" rpy="0 0 -0.26189"
                   axis="0 0 1"
                   lower="-3.1416" upper="3.1416"
                   effort="10" velocity="2.0"/>

  <xacro:rev_joint name="joint_2"
                   parent="link_1" child="link_2"
                   xyz="0.013919 0 0.040276" rpy="0 -0.49165 0"
                   axis="0 1 0"
                   lower="-1.5708" upper="1.5708"
                   effort="10" velocity="2.0"/>

  <xacro:rev_joint name="joint_3"
                   parent="link_2" child="link_3"
                   xyz="0 0 0.12"
                   rpy="-0.0085366 -0.072864 -0.0012933"
                   axis="0.0012899 -0.99996 -0.0086307"
                   lower="-1.5708" upper="1.5708"
                   effort="10" velocity="2.0"/>

  <xacro:rev_joint name="joint_4"
                   parent="link_3" child="link_4"
                   xyz="0.077872 0.013612 -0.0072246"
                   rpy="0.00023545 0.017066 0.0012724"
                   axis="0.99996 0.0002412 -0.0091073"
                   lower="-1.5708" upper="1.5708"
                   effort="10" velocity="2.0"/>

  <!-- gripper_base_joint (link_4 -> gripper_base_link) -->
  <xacro:rev_joint name="gripper_base_joint"
                   parent="link_4" child="gripper_base_link"
                   xyz="0.039739 5.0229E-05 0.0046381"
                   rpy="-0.025359 1.0602 -0.014195"
                   axis="0 0.99996 0.0087265"
                   lower="-3.1416" upper="3.1416"
                   effort="5" velocity="2.0"/>

  <!-- left_gear_joint - gripper open/close -->
  <xacro:rev_joint name="left_gear_joint"
                   parent="gripper_base_link" child="left_gear_link"
                   xyz="0.038 0.0018999 1.658E-05"
                   rpy="0.0087219 -0.00028924 0.033149"
                   axis="0 0 1"
                   lower="0" upper="1.0"
                   effort="5" velocity="1.0"/>

  <!-- Mimic joints for gripper mechanism -->
  <xacro:rev_joint_mimic name="left_finger_joint"
                        parent="left_gear_link" child="left_finger_link"
                        xyz="0.030728 0.0010745 0.013997"
                        rpy="0 0 -0.4368"
                        axis="0 0 -1"
                        lower="0" upper="1.0"
                        effort="2" velocity="1.0"
                        mimic_joint="left_gear_joint" multiplier="1" offset="0"/>

  <xacro:rev_joint_mimic name="right_gear_joint"
                        parent="gripper_base_link" child="right_gear_link"
                        xyz="0.038 -0.024999 -0.00021816"
                        rpy="0.0087077 0.00057486 -0.06592"
                        axis="0 0 1"
                        lower="-1.0" upper="0"
                        effort="2" velocity="1.0"
                        mimic_joint="left_gear_joint" multiplier="-1" offset="0"/>

  <xacro:rev_joint_mimic name="right_finger_joint"
                        parent="right_gear_link" child="right_finger_link"
                        xyz="0.030747 0 0.0055031"
                        rpy="-3.1416 0 0.46391"
                        axis="0 0 -1"
                        lower="0" upper="1.0"
                        effort="2" velocity="1.0"
                        mimic_joint="left_gear_joint" multiplier="1" offset="0"/>

  <xacro:rev_joint_mimic name="left_joint"
                        parent="gripper_base_link" child="left_link"
                        xyz="0.058 -0.016986 -0.0016533"
                        rpy="0.0087164 0.00042202 -0.048378"
                        axis="0 0 1"
                        lower="-1.0" upper="0"
                        effort="2" velocity="1.0"
                        mimic_joint="left_gear_joint" multiplier="-1" offset="0"/>

  <xacro:rev_joint_mimic name="right_joint"
                        parent="gripper_base_link" child="right_link"
                        xyz="0.058 -0.0069838 -0.001891"
                        rpy="0.0087015 -0.00066156 0.07588"
                        axis="0 0 1"
                        lower="0" upper="1.0"
                        effort="2" velocity="1.0"
                        mimic_joint="left_gear_joint" multiplier="1" offset="0"/>

</robot>